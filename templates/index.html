<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ë™ûÈü≥ËΩâÈåÑË©ï‰º∞Á≥ªÁµ±</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");

      :root {
        --primary-gradient: linear-gradient(135deg, #00d4aa 0%, #00b894 100%);
        --secondary-gradient: linear-gradient(135deg, #00cec9 0%, #55a3ff 100%);
        --success-gradient: linear-gradient(135deg, #00d4aa 0%, #00b894 100%);
        --warning-gradient: linear-gradient(135deg, #fdcb6e 0%, #e84393 100%);
        --danger-gradient: linear-gradient(135deg, #e84393 0%, #fd79a8 100%);
        --bg-gradient: linear-gradient(
          135deg,
          #0a0a0a 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        --glass-bg: rgba(0, 212, 170, 0.08);
        --glass-border: rgba(0, 212, 170, 0.15);
        --shadow-light: 0 8px 32px rgba(0, 212, 170, 0.1);
        --shadow-medium: 0 12px 40px rgba(0, 212, 170, 0.15);
        --shadow-heavy: 0 20px 60px rgba(0, 212, 170, 0.2);
        --text-primary: #ffffff;
        --text-secondary: #a0a0a0;
        --text-light: rgba(255, 255, 255, 0.9);
        --text-dim: rgba(255, 255, 255, 0.7);
        --accent-green: #00d4aa;
        --accent-cyan: #00cec9;
        --border-radius: 16px;
        --border-radius-sm: 8px;
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: var(--bg-gradient);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* ËÉåÊôØÂãïÁï´ */
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(
            circle at 20% 80%,
            rgba(0, 212, 170, 0.15) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(0, 206, 201, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 40%,
            rgba(85, 163, 255, 0.08) 0%,
            transparent 50%
          );
        animation: float 20s ease-in-out infinite;
        z-index: -1;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px) rotate(0deg);
        }
        33% {
          transform: translateY(-20px) rotate(1deg);
        }
        66% {
          transform: translateY(10px) rotate(-1deg);
        }
      }

      .container {
        max-width: 420px;
        margin: 0 auto;
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        min-height: 100vh;
        position: relative;
        overflow: hidden;
        box-shadow: 0 0 50px rgba(0, 212, 170, 0.1);
      }

      .container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          180deg,
          rgba(0, 212, 170, 0.05) 0%,
          rgba(0, 184, 148, 0.02) 100%
        );
        pointer-events: none;
      }

      .header {
        background: linear-gradient(
          135deg,
          rgba(0, 212, 170, 0.15) 0%,
          rgba(0, 206, 201, 0.1) 100%
        );
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--glass-border);
        color: var(--text-light);
        padding: 30px 20px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(0, 212, 170, 0.1) 0%,
          transparent 70%
        );
        animation: headerGlow 8s ease-in-out infinite;
      }

      @keyframes headerGlow {
        0%,
        100% {
          transform: rotate(0deg);
        }
        50% {
          transform: rotate(180deg);
        }
      }

      .header-content {
        position: relative;
        z-index: 1;
      }

      .header h1 {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 8px;
        text-shadow: 0 2px 20px rgba(0, 212, 170, 0.3);
        background: linear-gradient(
          135deg,
          var(--accent-green),
          var(--accent-cyan)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .header .subtitle {
        font-size: 14px;
        opacity: 0.8;
        font-weight: 400;
        color: var(--text-dim);
      }

      .main-content {
        padding: 25px 20px;
        position: relative;
        z-index: 1;
      }

      /* Ê®°ÂºèÂàáÊèõÂô® */
      .input-mode-switcher {
        display: flex;
        background: rgba(0, 212, 170, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 212, 170, 0.1);
        border-radius: var(--border-radius);
        padding: 6px;
        margin-bottom: 25px;
        box-shadow: var(--shadow-light);
      }

      .mode-button {
        flex: 1;
        padding: 12px 16px;
        border: none;
        border-radius: var(--border-radius-sm);
        background: transparent;
        color: var(--text-dim);
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .mode-button::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(0, 212, 170, 0.1) 0%,
          rgba(0, 206, 201, 0.05) 100%
        );
        opacity: 0;
        transition: var(--transition);
      }

      .mode-button:hover::before {
        opacity: 1;
      }

      .mode-button.active {
        background: linear-gradient(
          135deg,
          rgba(0, 212, 170, 0.2) 0%,
          rgba(0, 206, 201, 0.15) 100%
        );
        color: var(--accent-green);
        box-shadow: 0 4px 20px rgba(0, 212, 170, 0.2);
        transform: translateY(-1px);
      }

      /* Ê®ôÊ∫ñÊñáÊú¨Ëº∏ÂÖ•ÂçÄÂüü */
      .reference-section {
        background: rgba(0, 212, 170, 0.05);
        backdrop-filter: blur(15px);
        border: 2px solid rgba(0, 212, 170, 0.1);
        border-radius: var(--border-radius);
        padding: 20px;
        margin-bottom: 20px;
        transition: var(--transition);
      }

      .reference-section.ready {
        border-color: rgba(0, 212, 170, 0.3);
        background: rgba(0, 212, 170, 0.08);
        box-shadow: 0 0 30px rgba(0, 212, 170, 0.15);
      }

      .reference-title {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-light);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .reference-title::before {
        content: "üìÑ";
        font-size: 18px;
      }

      .reference-textarea {
        width: 100%;
        background: rgba(0, 212, 170, 0.03);
        border: 1px solid rgba(0, 212, 170, 0.1);
        border-radius: var(--border-radius-sm);
        padding: 12px 15px;
        color: var(--text-light);
        font-size: 14px;
        line-height: 1.5;
        resize: vertical;
        min-height: 80px;
        transition: var(--transition);
      }

      .reference-textarea:focus {
        outline: none;
        border-color: rgba(0, 212, 170, 0.3);
        background: rgba(0, 212, 170, 0.05);
        box-shadow: 0 0 20px rgba(0, 212, 170, 0.1);
      }

      .reference-textarea::placeholder {
        color: var(--text-dim);
      }

      .reference-hint {
        font-size: 12px;
        color: var(--text-dim);
        margin-top: 8px;
        line-height: 1.4;
      }

      /* Ëº∏ÂÖ•ÂçÄÂüü */
      .input-section {
        background: rgba(0, 212, 170, 0.05);
        backdrop-filter: blur(15px);
        border: 2px solid rgba(0, 212, 170, 0.1);
        border-radius: var(--border-radius);
        padding: 35px 25px;
        text-align: center;
        margin-bottom: 25px;
        min-height: 280px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        position: relative;
        overflow: hidden;
        transition: var(--transition);
      }

      .input-section::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          45deg,
          transparent 30%,
          rgba(0, 212, 170, 0.05) 50%,
          transparent 70%
        );
        transform: translateX(-100%);
        transition: transform 0.6s ease;
      }

      .input-section:hover::before {
        transform: translateX(100%);
      }

      .input-section.ready {
        border-color: rgba(0, 212, 170, 0.3);
        background: rgba(0, 212, 170, 0.08);
        box-shadow: 0 0 30px rgba(0, 212, 170, 0.15);
      }

      .input-section.active {
        border-color: rgba(0, 184, 148, 0.4);
        background: rgba(0, 184, 148, 0.1);
        box-shadow: 0 0 30px rgba(0, 184, 148, 0.2);
        animation: activePulse 2s ease-in-out infinite;
      }

      @keyframes activePulse {
        0%,
        100% {
          box-shadow: 0 0 30px rgba(0, 184, 148, 0.2);
        }
        50% {
          box-shadow: 0 0 50px rgba(0, 184, 148, 0.3);
        }
      }

      .input-section.processing {
        border-color: rgba(0, 206, 201, 0.4);
        background: rgba(0, 206, 201, 0.08);
        box-shadow: 0 0 30px rgba(0, 206, 201, 0.2);
      }

      .input-section.completed {
        border-color: rgba(0, 212, 170, 0.5);
        background: rgba(0, 212, 170, 0.1);
        box-shadow: 0 0 30px rgba(0, 212, 170, 0.25);
      }

      /* Ê™îÊ°à‰∏äÂÇ≥Ê®£Âºè */
      .upload-content,
      .file-selected,
      .recording-content {
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        position: relative;
        z-index: 1;
      }

      .upload-content.active,
      .file-selected.active,
      .recording-content.active {
        display: flex;
      }

      .upload-text {
        font-size: 22px;
        color: var(--text-light);
        margin-bottom: 8px;
        font-weight: 600;
        text-shadow: 0 2px 10px rgba(0, 212, 170, 0.3);
      }

      .upload-hint {
        font-size: 13px;
        color: var(--text-dim);
        margin-bottom: 25px;
        line-height: 1.5;
        max-width: 280px;
      }

      .file-input {
        display: none;
      }

      .upload-btn {
        background: linear-gradient(
          135deg,
          rgba(0, 212, 170, 0.15) 0%,
          rgba(0, 206, 201, 0.1) 100%
        );
        border: 1px solid rgba(0, 212, 170, 0.2);
        color: var(--accent-green);
        padding: 12px 24px;
        border-radius: var(--border-radius-sm);
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
        margin-bottom: 25px;
      }

      .upload-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(0, 212, 170, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .upload-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 212, 170, 0.2);
        border-color: rgba(0, 212, 170, 0.3);
      }

      .upload-btn:hover::before {
        left: 100%;
      }

      /* Ê™îÊ°àË≥áË®äÂç°Áâá */
      .file-info {
        background: rgba(0, 212, 170, 0.08);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(0, 212, 170, 0.15);
        border-radius: var(--border-radius-sm);
        padding: 16px 20px;
        margin-bottom: 20px;
        min-width: 220px;
        box-shadow: var(--shadow-medium);
      }

      .file-name {
        font-size: 16px;
        font-weight: 600;
        color: var(--text-light);
        margin-bottom: 5px;
        word-break: break-all;
      }

      .file-size {
        font-size: 13px;
        color: var(--text-dim);
      }

      .file-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
      }

      .file-action-btn {
        padding: 10px 18px;
        border: none;
        border-radius: var(--border-radius-sm);
        font-size: 13px;
        font-weight: 500;
        cursor: pointer;
        transition: var(--transition);
        backdrop-filter: blur(10px);
      }

      .change-file {
        background: rgba(0, 206, 201, 0.15);
        color: var(--accent-cyan);
        border: 1px solid rgba(0, 206, 201, 0.2);
      }

      .remove-file {
        background: rgba(232, 67, 147, 0.15);
        color: #e84393;
        border: 1px solid rgba(232, 67, 147, 0.2);
      }

      .file-action-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(0, 212, 170, 0.1);
      }

      /* ÈåÑÈü≥Ê®£Âºè */
      .recording-status {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
        color: var(--text-light);
        min-height: 22px;
        text-shadow: 0 2px 10px rgba(0, 212, 170, 0.3);
      }

      .record-button {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        border: 3px solid rgba(0, 212, 170, 0.3);
        background: linear-gradient(
          135deg,
          rgba(0, 212, 170, 0.2) 0%,
          rgba(0, 184, 148, 0.15) 100%
        );
        color: var(--accent-green);
        font-size: 28px;
        cursor: pointer;
        transition: var(--transition);
        margin-bottom: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 30px rgba(0, 212, 170, 0.2);
        position: relative;
        overflow: hidden;
      }

      .record-button::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(
          circle,
          rgba(0, 212, 170, 0.1) 0%,
          transparent 70%
        );
        opacity: 0;
        transition: var(--transition);
      }

      .record-button:hover:not(:disabled) {
        transform: scale(1.05);
        box-shadow: 0 12px 40px rgba(0, 212, 170, 0.3);
        border-color: rgba(0, 212, 170, 0.5);
      }

      .record-button:hover:not(:disabled)::before {
        opacity: 1;
      }

      .record-button:disabled {
        background: rgba(160, 160, 160, 0.1);
        color: var(--text-secondary);
        cursor: not-allowed;
        box-shadow: none;
        border-color: rgba(160, 160, 160, 0.2);
      }

      .record-button.recording {
        background: linear-gradient(
          135deg,
          rgba(0, 184, 148, 0.3) 0%,
          rgba(0, 212, 170, 0.2) 100%
        );
        animation: recordingPulse 1.5s ease-in-out infinite;
        box-shadow: 0 8px 30px rgba(0, 184, 148, 0.3);
        border-color: rgba(0, 184, 148, 0.5);
      }

      @keyframes recordingPulse {
        0%,
        100% {
          transform: scale(1);
          box-shadow: 0 8px 30px rgba(0, 184, 148, 0.3);
        }
        50% {
          transform: scale(1.1);
          box-shadow: 0 12px 40px rgba(0, 184, 148, 0.4);
        }
      }

      .recording-timer {
        font-size: 24px;
        font-weight: 700;
        color: var(--accent-green);
        margin-bottom: 15px;
        font-family: "Courier New", monospace;
        min-height: 30px;
        text-shadow: 0 2px 10px rgba(0, 212, 170, 0.3);
      }

      .recording-hint {
        font-size: 13px;
        color: var(--text-dim);
        line-height: 1.4;
        min-height: 18px;
      }

      /* ËôïÁêÜÊ≠•È©ü */
      .process-steps {
        margin: 25px 0;
        position: relative;
      }

      .step {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px 18px;
        margin-bottom: 10px;
        background: rgba(0, 212, 170, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(0, 212, 170, 0.1);
        border-radius: var(--border-radius-sm);
        transition: var(--transition);
        position: relative;
        overflow: hidden;
      }

      .step::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          45deg,
          transparent 30%,
          rgba(0, 212, 170, 0.05) 50%,
          transparent 70%
        );
        transform: translateX(-100%);
        transition: transform 0.6s ease;
      }

      .step.processing::before {
        transform: translateX(100%);
        animation: stepShine 2s ease-in-out infinite;
      }

      @keyframes stepShine {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      .step.waiting {
        border-color: rgba(0, 212, 170, 0.1);
        background: rgba(0, 212, 170, 0.02);
      }

      .step.ready {
        border-color: rgba(0, 212, 170, 0.3);
        background: rgba(0, 212, 170, 0.08);
        box-shadow: 0 4px 20px rgba(0, 212, 170, 0.1);
      }

      .step.processing {
        border-color: rgba(0, 206, 201, 0.4);
        background: rgba(0, 206, 201, 0.1);
        box-shadow: 0 4px 20px rgba(0, 206, 201, 0.15);
        animation: stepGlow 2s ease-in-out infinite;
      }

      @keyframes stepGlow {
        0%,
        100% {
          box-shadow: 0 4px 20px rgba(0, 206, 201, 0.15);
        }
        50% {
          box-shadow: 0 8px 30px rgba(0, 206, 201, 0.25);
        }
      }

      .step.completed {
        border-color: rgba(0, 184, 148, 0.4);
        background: rgba(0, 184, 148, 0.1);
        box-shadow: 0 4px 20px rgba(0, 184, 148, 0.15);
      }

      .step-left {
        display: flex;
        align-items: center;
        flex: 1;
      }

      .step-icon {
        font-size: 20px;
        margin-right: 12px;
        width: 24px;
        text-align: center;
        filter: drop-shadow(0 2px 8px rgba(0, 212, 170, 0.2));
        color: var(--accent-green);
      }

      .step-text {
        font-size: 15px;
        font-weight: 500;
        color: var(--text-light);
      }

      .step-status {
        font-size: 12px;
        padding: 6px 12px;
        border-radius: 15px;
        font-weight: 600;
        backdrop-filter: blur(10px);
        transition: var(--transition);
      }

      .step-status.waiting {
        background: rgba(0, 212, 170, 0.05);
        color: var(--text-dim);
        border: 1px solid rgba(0, 212, 170, 0.1);
      }

      .step-status.ready {
        background: rgba(0, 212, 170, 0.15);
        color: var(--accent-green);
        border: 1px solid rgba(0, 212, 170, 0.2);
      }

      .step-status.processing {
        background: rgba(0, 206, 201, 0.15);
        color: var(--accent-cyan);
        border: 1px solid rgba(0, 206, 201, 0.2);
      }

      .step-status.completed {
        background: rgba(0, 184, 148, 0.15);
        color: var(--accent-green);
        border: 1px solid rgba(0, 184, 148, 0.2);
      }

      .step-status.clickable {
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .step-status.clickable::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(0, 212, 170, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .step-status.clickable:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 15px rgba(0, 212, 170, 0.15);
      }

      .step-status.clickable:hover::before {
        left: 100%;
      }

      .step-status.clickable:after {
        content: " ‚Üó";
        font-size: 10px;
        opacity: 0.8;
      }

      /* Êìç‰ΩúÊåâÈàï */
      .action-btn {
        width: 100%;
        background: linear-gradient(
          135deg,
          rgba(0, 212, 170, 0.15) 0%,
          rgba(0, 184, 148, 0.1) 100%
        );
        border: 1px solid rgba(0, 212, 170, 0.2);
        color: var(--accent-green);
        padding: 16px 20px;
        border-radius: var(--border-radius);
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        margin: 25px 0 0 0;
        transition: var(--transition);
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
        box-shadow: var(--shadow-medium);
      }

      .action-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(0, 212, 170, 0.1),
          transparent
        );
        transition: left 0.5s ease;
      }

      .action-btn:hover:not(:disabled) {
        transform: translateY(-3px);
        box-shadow: 0 12px 40px rgba(0, 212, 170, 0.2);
        border-color: rgba(0, 212, 170, 0.3);
      }

      .action-btn:hover:not(:disabled)::before {
        left: 100%;
      }

      .action-btn:disabled {
        background: rgba(160, 160, 160, 0.05);
        color: var(--text-secondary);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        border-color: rgba(160, 160, 160, 0.1);
      }

      .action-btn.processing {
        background: linear-gradient(
          135deg,
          rgba(0, 206, 201, 0.2) 0%,
          rgba(0, 212, 170, 0.15) 100%
        );
        color: var(--accent-cyan);
        border-color: rgba(0, 206, 201, 0.3);
      }

      /* ËºâÂÖ•ÁãÄÊÖã */
      .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(0, 212, 170, 0.2);
        border-top: 2px solid var(--accent-green);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* ÂΩàÁ™óÊ®£Âºè */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(8px);
      }

      .modal-content {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        backdrop-filter: blur(20px);
        margin: 10% auto;
        padding: 30px;
        border-radius: var(--border-radius);
        width: 90%;
        max-width: 500px;
        box-shadow: var(--shadow-heavy);
        border: 1px solid rgba(0, 212, 170, 0.15);
        position: relative;
        overflow: hidden;
        max-height: 80vh;
        overflow-y: auto;
      }

      .modal-content::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(0, 212, 170, 0.05) 0%,
          rgba(0, 184, 148, 0.02) 100%
        );
        pointer-events: none;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid rgba(0, 212, 170, 0.1);
        position: relative;
        z-index: 1;
      }

      .modal-header h3 {
        font-size: 20px;
        font-weight: 600;
        color: var(--text-primary);
        background: linear-gradient(
          135deg,
          var(--accent-green),
          var(--accent-cyan)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .close {
        color: var(--text-secondary);
        font-size: 24px;
        font-weight: bold;
        cursor: pointer;
        transition: var(--transition);
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: rgba(0, 212, 170, 0.05);
        border: 1px solid rgba(0, 212, 170, 0.1);
      }

      .close:hover {
        color: var(--accent-green);
        background: rgba(0, 212, 170, 0.1);
        border-color: rgba(0, 212, 170, 0.2);
      }

      .modal-content-text {
        background: rgba(0, 212, 170, 0.05);
        padding: 20px;
        border-radius: var(--border-radius-sm);
        font-size: 14px;
        line-height: 1.6;
        color: var(--text-primary);
        border-left: 4px solid var(--accent-green);
        position: relative;
        z-index: 1;
        border: 1px solid rgba(0, 212, 170, 0.1);
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      .error-message {
        background: rgba(232, 67, 147, 0.1);
        border: 1px solid rgba(232, 67, 147, 0.2);
        color: #e84393;
        padding: 15px 20px;
        border-radius: var(--border-radius-sm);
        margin: 20px 0;
        font-size: 14px;
        backdrop-filter: blur(10px);
      }

      .hidden {
        display: none !important;
      }

      /* Ë©ï‰º∞ÁµêÊûúÂç°Áâá */
      .evaluation-result {
        background: rgba(0, 212, 170, 0.05);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(0, 212, 170, 0.1);
        border-radius: var(--border-radius-sm);
        padding: 20px;
        margin: 20px 0;
        display: none;
      }

      .evaluation-result.show {
        display: block;
        animation: slideInUp 0.5s ease-out;
      }

      @keyframes slideInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .metric-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 20px;
      }

      .metric-item {
        background: rgba(0, 212, 170, 0.03);
        border-radius: var(--border-radius-sm);
        padding: 15px;
        text-align: center;
        border: 1px solid rgba(0, 212, 170, 0.08);
        position: relative;
        overflow: hidden;
      }

      .metric-item::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(
          135deg,
          var(--accent-green),
          var(--accent-cyan)
        );
      }

      .metric-value {
        font-size: 24px;
        font-weight: 700;
        color: var(--accent-green);
        margin-bottom: 5px;
        text-shadow: 0 2px 10px rgba(0, 212, 170, 0.3);
      }

      .metric-label {
        font-size: 12px;
        color: var(--text-dim);
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.8px;
      }

      .accuracy-level {
        background: rgba(0, 212, 170, 0.08);
        border: 1px solid rgba(0, 212, 170, 0.15);
        border-radius: var(--border-radius-sm);
        padding: 12px 16px;
        margin-bottom: 20px;
        text-align: center;
      }

      .accuracy-level-title {
        font-size: 14px;
        color: var(--text-dim);
        margin-bottom: 5px;
        font-weight: 500;
      }

      .accuracy-level-value {
        font-size: 18px;
        font-weight: 700;
        color: var(--accent-green);
        text-shadow: 0 2px 10px rgba(0, 212, 170, 0.3);
      }

      .error-analysis {
        background: rgba(0, 212, 170, 0.03);
        border-radius: var(--border-radius-sm);
        padding: 15px;
        margin-bottom: 20px;
        border: 1px solid rgba(0, 212, 170, 0.08);
      }

      .error-analysis-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-light);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .error-analysis-title::before {
        content: "üìä";
        font-size: 16px;
      }

      .error-types {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
      }

      .error-type {
        background: rgba(0, 212, 170, 0.1);
        border: 1px solid rgba(0, 212, 170, 0.15);
        border-radius: 8px;
        padding: 8px 12px;
        font-size: 12px;
        color: var(--text-light);
        flex: 1;
        min-width: 80px;
        text-align: center;
      }

      .error-type-count {
        display: block;
        font-size: 16px;
        font-weight: 700;
        color: var(--accent-green);
        margin-bottom: 2px;
      }

      .error-type-label {
        font-size: 10px;
        color: var(--text-dim);
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .suggestions-section {
        background: rgba(0, 184, 148, 0.05);
        border: 1px solid rgba(0, 184, 148, 0.1);
        border-radius: var(--border-radius-sm);
        padding: 15px;
        border-left: 4px solid var(--accent-green);
      }

      .suggestions-title {
        font-size: 14px;
        font-weight: 600;
        color: var(--text-light);
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .suggestions-title::before {
        content: "üí°";
        font-size: 16px;
      }

      .suggestions-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .suggestions-list li {
        background: rgba(0, 212, 170, 0.05);
        border: 1px solid rgba(0, 212, 170, 0.1);
        border-radius: 6px;
        padding: 8px 12px;
        margin-bottom: 8px;
        font-size: 13px;
        color: var(--text-light);
        line-height: 1.4;
        position: relative;
        padding-left: 24px;
      }

      .suggestions-list li::before {
        content: "‚Ä¢";
        position: absolute;
        left: 12px;
        color: var(--accent-green);
        font-weight: bold;
      }

      .suggestions-list li:last-child {
        margin-bottom: 0;
      }

      /* ÊµÆÂãïÁ≤íÂ≠êËÉåÊôØ */
      .floating-particles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        pointer-events: none;
      }

      .particle {
        position: absolute;
        background: rgba(0, 212, 170, 0.1);
        border-radius: 50%;
        animation: float-particle 15s infinite linear;
      }

      @keyframes float-particle {
        0% {
          transform: translateY(100vh) rotate(0deg);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        90% {
          opacity: 1;
        }
        100% {
          transform: translateY(-100px) rotate(360deg);
          opacity: 0;
        }
      }

      /* ÈüøÊáâÂºèË®≠Ë®à */
      @media (max-width: 480px) {
        .container {
          max-width: 100%;
        }

        .main-content {
          padding: 20px 15px;
        }

        .input-section {
          padding: 30px 20px;
          min-height: 280px;
        }

        .record-button {
          width: 90px;
          height: 90px;
          font-size: 24px;
        }

        .upload-text {
          font-size: 18px;
        }

        .modal-content {
          margin: 20% auto;
          padding: 20px;
          width: 95%;
        }

        .metric-grid {
          grid-template-columns: 1fr;
          gap: 10px;
        }

        .error-types {
          flex-direction: column;
          gap: 8px;
        }
      }
    </style>
  </head>

  <body>
    <!-- ÊµÆÂãïÁ≤íÂ≠êËÉåÊôØ -->
    <div class="floating-particles" id="particles"></div>

    <div class="container">
      <div class="header">
        <div class="header-content">
          <h1>Ë™ûÈü≥ËΩâÈåÑË©ï‰º∞Á≥ªÁµ±</h1>
          <div class="subtitle">Ë™ûÈü≥Ê∫ñÁ¢∫ÊÄßÂàÜÊûêËàáÂìÅË≥™Ë©ï‰º∞</div>
        </div>
      </div>

      <div class="main-content">
        <!-- Ëº∏ÂÖ•Ê®°ÂºèÂàáÊèõ -->
        <div class="input-mode-switcher">
          <button class="mode-button active" onclick="switchToUpload()">
            Ê™îÊ°à‰∏äÂÇ≥
          </button>
          <button class="mode-button" onclick="switchToRecording()">
            Âç≥ÊôÇÈåÑÈü≥
          </button>
        </div>

        <!-- Áµ±‰∏ÄÁöÑËº∏ÂÖ•ÂçÄÂüü -->
        <div class="input-section" id="inputSection">
          <!-- Ê™îÊ°à‰∏äÂÇ≥ÂÖßÂÆπ -->
          <div class="upload-content active" id="uploadContent">
            <input
              type="file"
              id="audioFile"
              class="file-input"
              accept=".mp3,.wav,.m4a,.aac,.ogg,.webm,.flac,.mp4,.avi,.mov"
              onchange="handleFileSelect(event)"
            />
            <div class="upload-text">ÈÅ∏ÊìáÈü≥È†ªÊ™îÊ°à</div>
            <button
              class="upload-btn"
              onclick="document.getElementById('audioFile').click()"
            >
              ÁÄèË¶ΩÊ™îÊ°à
            </button>
            <div class="upload-hint">
              ÊîØÊè¥ MP3„ÄÅWAV„ÄÅM4A Á≠âÂ§öÁ®ÆÈü≥È†ªÊ†ºÂºè<br />Ê™îÊ°àÂ§ßÂ∞èÈôêÂà∂ 100MB
            </div>
          </div>

          <!-- Ê™îÊ°àÂ∑≤ÈÅ∏‰∏≠ -->
          <div class="file-selected" id="fileSelected">
            <div class="upload-text">Ê™îÊ°àÂ∑≤Ê∫ñÂÇô</div>
            <div class="file-info">
              <div id="fileName" class="file-name"></div>
              <div id="fileSize" class="file-size"></div>
            </div>
            <div class="file-actions">
              <button
                class="file-action-btn change-file"
                onclick="document.getElementById('audioFile').click()"
              >
                Êõ¥ÊèõÊ™îÊ°à
              </button>
              <button
                class="file-action-btn remove-file"
                onclick="removeFile()"
              >
                ÁßªÈô§Ê™îÊ°à
              </button>
            </div>
          </div>

          <!-- ÈåÑÈü≥ÂÖßÂÆπ -->
          <div class="recording-content" id="recordingContent">
            <button
              class="record-button"
              id="recordButton"
              onclick="toggleRecording()"
            >
              ‚óè
            </button>
            <div class="recording-timer" id="recordingTimer">00:00</div>
            <div class="recording-hint" id="recordingHint">ÈªûÊìäÈñãÂßãÈåÑÈü≥</div>
          </div>
        </div>

        <!-- Ê®ôÊ∫ñÊñáÊú¨Ëº∏ÂÖ•ÂçÄÂüü -->
        <div class="reference-section" id="referenceSection">
          <div class="reference-title">Ê®ôÊ∫ñÂèÉËÄÉÊñáÊú¨</div>
          <textarea
            id="referenceText"
            class="reference-textarea"
            placeholder="Ë´ãËº∏ÂÖ•Ê®ôÊ∫ñÊñáÊú¨‰ΩúÁÇ∫Ë©ï‰º∞Âü∫Ê∫ñ&#10;ÁØÑ‰æãÔºö‰ªäÂ§©Â§©Ê∞£ÁúüÂ•ΩÔºåÈÅ©ÂêàÂá∫ÂéªËµ∞Ëµ∞„ÄÇ"
            oninput="updateReferenceText()"
          ></textarea>
          <div class="reference-hint">
            Ë´ãËº∏ÂÖ•ÊÇ®Â∏åÊúõÁî®‰æÜÊØîÂ∞çÁöÑÊ®ôÊ∫ñÊñáÊú¨ÔºåÁ≥ªÁµ±Â∞áÂàÜÊûêË™ûÈü≥ËΩâÈåÑÁöÑÊ∫ñÁ¢∫ÊÄß
          </div>
        </div>

        <!-- ËôïÁêÜÊ≠•È©ü -->
        <div class="process-steps">
          <div class="step waiting" id="step1">
            <div class="step-left">
              <div class="step-icon">üìÅ</div>
              <div class="step-text" id="step1Text">Ê∫ñÂÇôËº∏ÂÖ•</div>
            </div>
            <div class="step-status waiting" id="step1Status">Á≠âÂæÖ‰∏≠</div>
          </div>

          <div class="step waiting" id="step2">
            <div class="step-left">
              <div class="step-icon">üéôÔ∏è</div>
              <div class="step-text">Ë™ûÈü≥ËΩâÊñáÂ≠ó</div>
            </div>
            <div class="step-status waiting" id="step2Status">Á≠âÂæÖ‰∏≠</div>
          </div>

          <div class="step waiting" id="step3">
            <div class="step-left">
              <div class="step-icon">üß†</div>
              <div class="step-text">Ê∫ñÁ¢∫ÊÄßÂàÜÊûê</div>
            </div>
            <div class="step-status waiting" id="step3Status">Á≠âÂæÖ‰∏≠</div>
          </div>

          <div class="step waiting" id="step4">
            <div class="step-left">
              <div class="step-icon">üìä</div>
              <div class="step-text">Ë©ï‰º∞Â†±Âëä</div>
            </div>
            <div class="step-status waiting" id="step4Status">Á≠âÂæÖ‰∏≠</div>
          </div>
        </div>

        <!-- Ë©ï‰º∞ÁµêÊûúÈ°ØÁ§∫ -->
        <div class="evaluation-result" id="evaluationResult">
          <!-- Ë©ï‰º∞Á≠âÁ¥öÈ°ØÁ§∫ -->
          <div class="accuracy-level" id="accuracyLevel" style="display: none">
            <div class="accuracy-level-title">Ë©ï‰º∞Á≠âÁ¥ö</div>
            <div class="accuracy-level-value" id="accuracyLevelValue">--</div>
          </div>

          <div class="metric-grid">
            <div class="metric-item">
              <div class="metric-value" id="accuracyScore">--</div>
              <div class="metric-label">Ê∫ñÁ¢∫Áéá (%)</div>
            </div>
            <div class="metric-item">
              <div class="metric-value" id="similarityScore">--</div>
              <div class="metric-label">Ë™ûÊÑèÁõ∏‰ººÂ∫¶ (%)</div>
            </div>
          </div>

          <div class="error-analysis">
            <div class="error-analysis-title">ÈåØË™§ÂàÜÊûêÁµ±Ë®à</div>
            <div class="error-types">
              <div class="error-type">
                <span class="error-type-count" id="substitutions">0</span>
                <span class="error-type-label">ÊõøÊèõÈåØË™§</span>
              </div>
              <div class="error-type">
                <span class="error-type-count" id="deletions">0</span>
                <span class="error-type-label">Âà™Èô§ÈåØË™§</span>
              </div>
              <div class="error-type">
                <span class="error-type-count" id="insertions">0</span>
                <span class="error-type-label">ÊèíÂÖ•ÈåØË™§</span>
              </div>
            </div>
          </div>

          <div class="suggestions-section" id="suggestionsSection">
            <div class="suggestions-title">ÊîπÈÄ≤Âª∫Ë≠∞</div>
            <ul class="suggestions-list" id="suggestionsList">
              <li>Á≠âÂæÖÂàÜÊûêÁµêÊûú...</li>
            </ul>
          </div>
        </div>

        <!-- Êìç‰ΩúÊåâÈàï -->
        <button
          class="action-btn"
          id="actionBtn"
          onclick="startEvaluation()"
          disabled
        >
          <span id="btnText">Ë´ãÂÖàËº∏ÂÖ•Ê®ôÊ∫ñÊñáÊú¨ÂíåÈÅ∏ÊìáÈü≥È†ª</span>
          <div class="loading hidden" id="btnLoading">
            <div class="spinner"></div>
            Ë©ï‰º∞‰∏≠...
          </div>
        </button>

        <!-- Êñ∞Â¢ûÁöÑÈáçË®≠ÊåâÈàï -->
        <button
          class="action-btn hidden"
          id="resetBtn"
          onclick="resetEvaluation()"
        >
          <span id="resetBtnText">ÈÄ≤Ë°åÊñ∞Ë©ï‰º∞</span>
        </button>

        <!-- ÈåØË™§Ë®äÊÅØ -->
        <div id="errorMessage" class="error-message hidden"></div>
      </div>
    </div>

    <!-- ËΩâÈåÑÁµêÊûúÂΩàÁ™ó -->
    <div id="transcriptionModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Ë™ûÈü≥ËΩâÈåÑÁµêÊûú</h3>
          <span class="close" onclick="closeTranscriptionModal()">&times;</span>
        </div>
        <div class="modal-content-text" id="transcriptionText">
          Á≠âÂæÖËΩâÈåÑÁµêÊûú...
        </div>
      </div>
    </div>

    <!-- ÂàÜÊûêË©≥ÊÉÖÂΩàÁ™ó -->
    <div id="analysisModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Ë©≥Á¥∞ÂàÜÊûêÁµêÊûú</h3>
          <span class="close" onclick="closeAnalysisModal()">&times;</span>
        </div>
        <div class="modal-content-text" id="analysisText">Á≠âÂæÖÂàÜÊûêÁµêÊûú...</div>
      </div>
    </div>

    <!-- Â†±ÂëäÈ†êË¶ΩÂΩàÁ™ó -->
    <div id="reportModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Ë©ï‰º∞Â†±ÂëäÈ†êË¶Ω</h3>
          <span class="close" onclick="closeReportModal()">&times;</span>
        </div>
        <div class="modal-content-text" id="reportText">ËºâÂÖ•Â†±Âëä‰∏≠...</div>
      </div>
    </div>

    <script>
      // ÁãÄÊÖãËÆäÊï∏
      let selectedFile = null;
      let referenceText = "";
      let transcriptionResult = "";
      let evaluationResult = null;
      let isRecording = false;
      let recordingTimer = null;
      let recordingStartTime = null;
      let currentInputMode = "upload";
      let isProcessing = false;

      // DOM ÂÖÉÁ¥†Âø´ÂèñÔºåÊèêÂçáÊïàËÉΩ
      const dom = {
        modeButtons: document.querySelectorAll(".mode-button"),
        uploadContent: document.getElementById("uploadContent"),
        recordingContent: document.getElementById("recordingContent"),
        fileSelected: document.getElementById("fileSelected"),
        step1Text: document.getElementById("step1Text"),
        recordButton: document.getElementById("recordButton"),
        recordingHint: document.getElementById("recordingHint"),
        inputSection: document.getElementById("inputSection"),
        recordingTimer: document.getElementById("recordingTimer"),
        audioFile: document.getElementById("audioFile"),
        fileName: document.getElementById("fileName"),
        fileSize: document.getElementById("fileSize"),
        referenceText: document.getElementById("referenceText"),
        referenceSection: document.getElementById("referenceSection"),
        actionBtn: document.getElementById("actionBtn"),
        btnText: document.getElementById("btnText"),
        btnLoading: document.getElementById("btnLoading"),
        resetBtn: document.getElementById("resetBtn"),
        errorMessage: document.getElementById("errorMessage"),
        evaluationResult: document.getElementById("evaluationResult"),
        accuracyLevel: document.getElementById("accuracyLevel"),
        accuracyLevelValue: document.getElementById("accuracyLevelValue"),
        accuracyScore: document.getElementById("accuracyScore"),
        similarityScore: document.getElementById("similarityScore"),
        substitutions: document.getElementById("substitutions"),
        deletions: document.getElementById("deletions"),
        insertions: document.getElementById("insertions"),
        suggestionsList: document.getElementById("suggestionsList"),
        transcriptionModal: document.getElementById("transcriptionModal"),
        transcriptionText: document.getElementById("transcriptionText"),
        analysisModal: document.getElementById("analysisModal"),
        analysisText: document.getElementById("analysisText"),
        reportModal: document.getElementById("reportModal"),
        reportText: document.getElementById("reportText"),
        particles: document.getElementById("particles"),
      };

      // --- ÂàùÂßãÂåñÂáΩÂºè ---
      function initParticles() {
        const particleCount = 12;
        for (let i = 0; i < particleCount; i++) {
          const particle = document.createElement("div");
          particle.className = "particle";
          particle.style.left = `${Math.random() * 100}%`;
          const size = Math.random() * 3 + 2;
          particle.style.width = `${size}px`;
          particle.style.height = `${size}px`;
          particle.style.animationDelay = `${Math.random() * 15}s`;
          particle.style.animationDuration = `${Math.random() * 10 + 12}s`;
          dom.particles.appendChild(particle);
        }
      }

      // --- UI ÂàáÊèõËàáÁãÄÊÖãÊõ¥Êñ∞ÂáΩÂºè ---
      function updateReferenceText() {
        referenceText = dom.referenceText.value.trim();
        dom.referenceSection.classList.toggle("ready", !!referenceText);
        updateActionButton();
      }

      function switchToUpload() {
        if (isProcessing) return;
        currentInputMode = "upload";
        dom.modeButtons[0].classList.add("active");
        dom.modeButtons[1].classList.remove("active");
        dom.uploadContent.classList.add("active");
        dom.recordingContent.classList.remove("active");
        dom.fileSelected.classList.remove("active");
        dom.step1Text.textContent = "Ê™îÊ°àÊ∫ñÂÇô";
        resetEvaluation();
      }

      function switchToRecording() {
        if (isProcessing) return;
        currentInputMode = "recording";
        dom.modeButtons[0].classList.remove("active");
        dom.modeButtons[1].classList.add("active");
        dom.uploadContent.classList.remove("active");
        dom.fileSelected.classList.remove("active");
        dom.recordingContent.classList.add("active");
        dom.step1Text.textContent = "ÈåÑÈü≥Ê∫ñÂÇô";
        resetEvaluation();
      }

      // --- ÈåÑÈü≥Áõ∏ÈóúÂáΩÂºè ---
      async function toggleRecording() {
        if (isProcessing) return;
        await (isRecording ? stopRecording() : startRecording());
      }

      async function startRecording() {
        try {
          const response = await fetch("/recording/start", { method: "POST" });
          if (!response.ok)
            throw new Error(`HTTP ÈåØË™§! ÁãÄÊÖã: ${response.status}`);
          const data = await response.json();

          if (data.success) {
            isRecording = true;
            recordingStartTime = Date.now();
            dom.recordButton.classList.add("recording");
            dom.recordButton.textContent = "‚èπÔ∏è";
            dom.recordingHint.textContent = "ÈªûÊìäÂÅúÊ≠¢ÈåÑÈü≥";
            dom.inputSection.className = "input-section active";
            startRecordingTimer();
            updateStep("step1", "processing", "ÈåÑÈü≥‰∏≠");
            updateActionButton();
          } else {
            showError(`ÁÑ°Ê≥ïÈñãÂßãÈåÑÈü≥Ôºö${data.error || "Êú™Áü•ÈåØË™§"}`);
          }
        } catch (error) {
          showError(`ÈåÑÈü≥ÈñãÂßãÂ§±ÊïóÔºö${error.message}`);
        }
      }

      async function stopRecording() {
        if (!referenceText) {
          showError("Ë´ãÂÖàËº∏ÂÖ•Ê®ôÊ∫ñÂèÉËÄÉÊñáÊú¨ÊâçËÉΩÈÄ≤Ë°åË©ï‰º∞");
          return;
        }

        isProcessing = true;
        if (recordingTimer) clearInterval(recordingTimer);
        recordingTimer = null;
        dom.inputSection.className = "input-section processing";
        updateStep("step1", "completed", "ÈåÑÈü≥ÂÆåÊàê");
        updateStep("step2", "processing", "ËΩâÈåÑ‰∏≠...");
        updateStep("step3", "processing", "ÂàÜÊûê‰∏≠...");
        updateStep("step4", "processing", "ÁîüÊàêÂ†±Âëä...");
        updateActionButton();

        try {
          const response = await fetch("/recording/stop", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ reference_text: referenceText }),
          });

          if (!response.ok)
            throw new Error(`HTTP ÈåØË™§! ÁãÄÊÖã: ${response.status}`);
          const data = await response.json();

          if (data.success) {
            dom.inputSection.className = "input-section completed";
            evaluationResult = data;
            await handleEvaluationResult(data);
          } else {
            throw new Error(data.error || "ÈåÑÈü≥ËôïÁêÜÂ§±Êïó");
          }
        } catch (error) {
          showError(`ÈåÑÈü≥ËôïÁêÜÂ§±ÊïóÔºö${error.message}`);
          resetStepsAfter(1);
        } finally {
          isProcessing = false;
          if (evaluationResult || dom.errorMessage.textContent) {
            dom.actionBtn.classList.add("hidden");
            dom.resetBtn.classList.remove("hidden");
          } else {
            updateActionButton();
          }
          resetRecordingState();
        }
      }

      function resetRecordingState() {
        isRecording = false;
        dom.recordButton.classList.remove("recording");
        dom.recordButton.textContent = "‚óè";
        dom.recordingTimer.textContent = "00:00";
        dom.recordingHint.textContent = "ÈªûÊìäÈñãÂßãÈåÑÈü≥";
        if (recordingTimer) clearInterval(recordingTimer);
        recordingTimer = null;
      }

      function startRecordingTimer() {
        recordingTimer = setInterval(() => {
          if (recordingStartTime) {
            const elapsed = Math.floor(
              (Date.now() - recordingStartTime) / 1000
            );
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            dom.recordingTimer.textContent = `${minutes
              .toString()
              .padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
          }
        }, 1000);
      }

      // --- Ê™îÊ°àËôïÁêÜÂáΩÂºè ---
      function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file) handleFile(file);
      }

      function handleFile(file) {
        selectedFile = file;
        dom.fileName.textContent = file.name;
        dom.fileSize.textContent = formatFileSize(file.size);
        dom.uploadContent.classList.remove("active");
        dom.fileSelected.classList.add("active");
        dom.inputSection.className = "input-section ready";
        updateStep("step1", "ready", "Ê™îÊ°àÂ∑≤ÈÅ∏");
        resetStepsAfter(1);
        hideError();
        updateActionButton();
      }

      function removeFile() {
        selectedFile = null;
        dom.uploadContent.classList.add("active");
        dom.fileSelected.classList.remove("active");
        dom.inputSection.className = "input-section";
        dom.audioFile.value = "";
        updateStep("step1", "waiting", "Á≠âÂæÖ‰∏≠");
        resetStepsAfter(1);
        updateActionButton();
        hideEvaluationResult();
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return `${parseFloat((bytes / Math.pow(k, i)).toFixed(2))} ${sizes[i]}`;
      }

      // --- Ê†∏ÂøÉÊµÅÁ®ãËàá UI Êõ¥Êñ∞ ---
      function updateStep(stepId, status, text) {
        const step = document.getElementById(stepId);
        const statusEl = document.getElementById(`${stepId}Status`);
        step.className = `step ${status}`;
        statusEl.className = `step-status ${status}`;
        statusEl.textContent = text;
        statusEl.onclick = null; // ÈáçË®≠ÈªûÊìä‰∫ã‰ª∂

        if (status === "completed") {
          statusEl.classList.add("clickable");
          if (stepId === "step2") statusEl.onclick = () => showTranscription();
          else if (stepId === "step3")
            statusEl.onclick = () => showAnalysisDetails();
          else if (stepId === "step4")
            statusEl.onclick = () => showReportPreview();
        }
      }

      function updateActionButton() {
        const btnText = dom.btnText;
        const btnLoading = dom.btnLoading;
        const btn = dom.actionBtn;

        if (isProcessing) {
          btn.disabled = true;
          btn.classList.add("processing");
          btnText.classList.add("hidden");
          btnLoading.classList.remove("hidden");
          return;
        }

        btnText.classList.remove("hidden");
        btnLoading.classList.add("hidden");
        btn.classList.remove("processing");

        if (!referenceText) {
          btn.disabled = true;
          btnText.textContent = "Ë´ãÂÖàËº∏ÂÖ•Ê®ôÊ∫ñÊñáÊú¨";
        } else if (currentInputMode === "upload") {
          if (selectedFile) {
            btn.disabled = false;
            btnText.textContent = "ÈñãÂßãË©ï‰º∞";
          } else {
            btn.disabled = true;
            btnText.textContent = "Ë´ãÈÅ∏ÊìáÈü≥È†ªÊ™îÊ°à";
          }
        } else {
          btn.disabled = true;
          btnText.textContent = "Ë´ã‰ΩøÁî®ÈåÑÈü≥ÊåâÈàï";
        }
      }

      async function startEvaluation() {
        if (!selectedFile || !referenceText || isProcessing) return;

        isProcessing = true;
        hideError();
        hideEvaluationResult();
        updateActionButton();
        dom.inputSection.className = "input-section processing";

        const formData = new FormData();
        formData.append("audio", selectedFile);
        formData.append("reference_text", referenceText);

        try {
          updateStep("step2", "processing", "ËΩâÈåÑ‰∏≠...");
          updateStep("step3", "processing", "ÂàÜÊûê‰∏≠...");
          updateStep("step4", "processing", "ÁîüÊàêÂ†±Âëä...");

          const response = await fetch("/evaluation/analyze", {
            method: "POST",
            body: formData,
          });

          if (!response.ok)
            throw new Error(`HTTP ÈåØË™§! ÁãÄÊÖã: ${response.status}`);
          const data = await response.json();

          if (data.success) {
            dom.inputSection.className = "input-section completed";
            evaluationResult = data;
            await handleEvaluationResult(data);
          } else {
            throw new Error(data.error || "Ë©ï‰º∞Â§±Êïó");
          }
        } catch (error) {
          showError(`Ë©ï‰º∞ÈÅéÁ®ãÁôºÁîüÈåØË™§Ôºö${error.message}`);
          dom.inputSection.className = "input-section ready";
          resetStepsAfter(1);
        } finally {
          isProcessing = false;
          if (evaluationResult || dom.errorMessage.textContent) {
            dom.actionBtn.classList.add("hidden");
            dom.resetBtn.classList.remove("hidden");
          } else {
            updateActionButton();
          }
        }
      }

      async function handleEvaluationResult(data) {
        if (
          !data ||
          !data.transcription ||
          !data.comparison ||
          !data.evaluation_metrics
        ) {
          showError("Ë©ï‰º∞ÁµêÊûúÊï∏Êìö‰∏çÂÆåÊï¥ÊàñÊ†ºÂºèÈåØË™§");
          resetStepsAfter(1);
          return;
        }
        transcriptionResult = data.transcription.transcript || "ÁÑ°ËΩâÈåÑÁµêÊûú";
        updateStep("step2", "completed", "Êü•ÁúãËΩâÈåÑ");
        updateStep("step3", "completed", "Êü•ÁúãË©≥ÊÉÖ");
        updateStep("step4", "completed", "Êü•ÁúãÂ†±Âëä");
        showEvaluationResult(data);
      }

      function showEvaluationResult(data) {
        const metrics = data.evaluation_metrics;
        const comparison = data.comparison;

        dom.accuracyScore.textContent = (metrics.accuracy_score ?? 0).toFixed(
          1
        );
        dom.similarityScore.textContent = (
          metrics.semantic_similarity ?? 0
        ).toFixed(1);

        if (metrics.accuracy_level) {
          dom.accuracyLevelValue.textContent = metrics.accuracy_level;
          dom.accuracyLevel.style.display = "block";
        }

        const errorAnalysis = comparison.error_analysis || {};
        dom.substitutions.textContent = errorAnalysis.substitutions ?? 0;
        dom.deletions.textContent = errorAnalysis.deletions ?? 0;
        dom.insertions.textContent = errorAnalysis.insertions ?? 0;

        const suggestions = comparison.suggestions || [];
        dom.suggestionsList.innerHTML = "";
        if (suggestions.length > 0) {
          suggestions.forEach((suggestion) => {
            const li = document.createElement("li");
            li.textContent = suggestion;
            dom.suggestionsList.appendChild(li);
          });
        } else {
          dom.suggestionsList.innerHTML = "<li>Êö´ÁÑ°ÁâπÂÆöÂª∫Ë≠∞</li>";
        }

        dom.evaluationResult.classList.add("show");
      }

      // --- ÈáçË®≠ËàáÊ∏ÖÁêÜÂáΩÂºè ---
      function resetEvaluation() {
        dom.actionBtn.classList.remove("hidden");
        dom.resetBtn.classList.add("hidden");

        selectedFile = null;
        referenceText = "";
        transcriptionResult = "";
        evaluationResult = null;
        isProcessing = false;

        dom.referenceText.value = "";
        dom.audioFile.value = "";

        dom.uploadContent.classList.toggle(
          "active",
          currentInputMode === "upload"
        );
        dom.fileSelected.classList.remove("active");
        dom.inputSection.className = "input-section";
        dom.referenceSection.classList.remove("ready");

        hideEvaluationResult();
        resetAllSteps();
        updateActionButton();
        hideError();
        resetRecordingState();
      }

      function resetStepsAfter(stepNum) {
        for (let i = stepNum + 1; i <= 4; i++) {
          updateStep(`step${i}`, "waiting", "Á≠âÂæÖ‰∏≠");
        }
      }

      function hideEvaluationResult() {
        dom.evaluationResult.classList.remove("show");
        dom.accuracyLevel.style.display = "none";
      }

      // --- ÂΩàÁ™ó (Modal) ËôïÁêÜÂáΩÂºè ---
      function showModal(modal) {
        modal.style.display = "block";
      }

      function closeModal(modal) {
        modal.style.display = "none";
      }

      function showTranscription() {
        dom.transcriptionText.textContent =
          transcriptionResult || "Êö´ÁÑ°ËΩâÈåÑÁµêÊûú";
        showModal(dom.transcriptionModal);
      }

      function closeTranscriptionModal() {
        closeModal(dom.transcriptionModal);
      }

      function showAnalysisDetails() {
        if (!evaluationResult || !evaluationResult.comparison) {
          dom.analysisText.textContent = "Êö´ÁÑ°ÂàÜÊûêÁµêÊûú";
        } else {
          const { summary, reasoning, key_differences } =
            evaluationResult.comparison;
          const analysisText = `Ë©ï‰º∞ÊëòË¶ÅÔºö\n${
            summary || "ÁÑ°ÊëòË¶Å"
          }\n\nÂàÜÊûêÁêÜÁî±Ôºö\n${reasoning || "ÁÑ°Ë©≥Á¥∞ÁêÜÁî±"}\n\n‰∏ªË¶ÅÂ∑ÆÁï∞Ôºö\n${
            (key_differences || []).join("\n") || "ÁÑ°‰∏ªË¶ÅÂ∑ÆÁï∞"
          }`.trim();
          dom.analysisText.textContent = analysisText;
        }
        showModal(dom.analysisModal);
      }

      function closeAnalysisModal() {
        closeModal(dom.analysisModal);
      }

      function showReportPreview() {
        if (!evaluationResult) {
          dom.reportText.textContent = "Êö´ÁÑ°Â†±ÂëäÊï∏Êìö";
        } else {
          const {
            evaluation_id,
            processing_time,
            comparison,
            evaluation_metrics,
          } = evaluationResult;

          const reportText = `Ë©ï‰º∞IDÔºö${evaluation_id || "Êú™Áü•"}
ËôïÁêÜÊôÇÈñìÔºö${(processing_time || 0).toFixed(2)} Áßí

Ë©ï‰º∞Á≠âÁ¥öÔºö${evaluation_metrics?.accuracy_level || "Êú™Ë©ïÁ¥ö"}

Êï¥È´îÊåáÊ®ôÔºö
‚Ä¢ Ê∫ñÁ¢∫ÁéáÔºö${(evaluation_metrics?.accuracy_score ?? 0).toFixed(1)}%
‚Ä¢ Ë™ûÊÑèÁõ∏‰ººÂ∫¶Ôºö${(evaluation_metrics?.semantic_similarity ?? 0).toFixed(1)}%

ÈåØË™§Áµ±Ë®àÔºö
‚Ä¢ ÊõøÊèõÈåØË™§Ôºö${comparison?.error_analysis?.substitutions ?? 0} ÂÄã
‚Ä¢ Âà™Èô§ÈåØË™§Ôºö${comparison?.error_analysis?.deletions ?? 0} ÂÄã
‚Ä¢ ÊèíÂÖ•ÈåØË™§Ôºö${comparison?.error_analysis?.insertions ?? 0} ÂÄã

Âª∫Ë≠∞Ôºö
${
  (comparison?.suggestions || []).map((s) => `‚Ä¢ ${s}`).join("\n") ||
  "Êö´ÁÑ°ÁâπÂÆöÂª∫Ë≠∞"
}`.trim();
          dom.reportText.textContent = reportText;
        }
        showModal(dom.reportModal);
      }

      function closeReportModal() {
        closeModal(dom.reportModal);
      }

      // --- ÈåØË™§ËôïÁêÜ ---
      function showError(message) {
        dom.errorMessage.textContent = message;
        dom.errorMessage.classList.remove("hidden");
      }

      function hideError() {
        dom.errorMessage.classList.add("hidden");
      }

      // --- ÂÖ®Âüü‰∫ã‰ª∂Áõ£ËÅΩ ---
      window.onclick = function (event) {
        if (event.target.classList.contains("modal")) {
          closeModal(event.target);
        }
      };

      window.onload = function () {
        initParticles();
        checkApiStatus();
        updateActionButton();
      };

      async function checkApiStatus() {
        try {
          const response = await fetch("/status");
          if (!response.ok) throw new Error("API ÊúçÂãôÈüøÊáâÁï∞Â∏∏");
          const data = await response.json();
          if (data.app_status !== "running") {
            showError("API ÊúçÂãôÊú™Ê≠£Â∏∏ÈÅãË°åÔºåË´ãÊ™¢Êü•ÂæåÁ´ØÊúçÂãôÁãÄÊÖã");
          }
        } catch (error) {
          showError(`ÁÑ°Ê≥ïÈÄ£Êé•Âà∞ API ÊúçÂãôÔºö${error.message}`);
        }
      }
    </script>
  </body>
</html>
